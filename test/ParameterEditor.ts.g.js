"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _Dropdown = _interopRequireDefault(require("../controls/Dropdown"));
var _App = _interopRequireDefault(require("Native/App"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
class ParametersEditor {
  constructor() {
    _defineProperty(this, "haveSelected", false);
    _defineProperty(this, "developer", false);
    _defineProperty(this, "visible", false);
    _defineProperty(this, "sections", []);
    _defineProperty(this, "parameters", []);
    _defineProperty(this, "mappedSections", {});
  }
  open() {
    this.filterMenu();
    this.visible = true;
  }
  close() {
    this.visible = false;
  }
  clear() {
    this.sections.length = 0;
    this.parameters.length = 0;
    this.mappedSections = {};
  }
  addSection(name) {
    var section = new MenuSection(this, name);
    this.sections.push(section);
    this.mappedSections[name] = section;
    return section;
  }
  filterMenu(developer) {
    if (developer === undefined) developer = this.developer;
    for (var i = 0; i < this.sections.length; i++) {
      this.sections[i].visible = false;
      for (var j = 0; j < this.sections[i].parameters.length; j++) {
        this.sections[i].parameters[j].visible = !this.sections[i].parameters[j].developer || developer;
        if (this.sections[i].parameters[j].visible) this.sections[i].visible = true;
      }
    }
    if (!this.haveSelected) {
      for (var j = 0; j < this.sections.length; j++) {
        if (this.sections[j].visible) {
          this.onSelected(this.sections[j]);
          return;
        }
      }
    } else if (!developer) {
      for (var i = 0; i < this.sections.length; i++) {
        if (this.sections[i].selected && !this.sections[i].visible) {
          for (var j = 0; j < this.sections.length; j++) {
            if (this.sections[j].visible) {
              this.onSelected(this.sections[j]);
              return;
            }
          }
        }
      }
    }
  }
  onSelected(arg) {
    this.parameters = arg.parameters;
    this.haveSelected = true;
    for (var i = 0; i < this.sections.length; i++) this.sections[i].selected = this.sections[i] === arg;
    _App.default.queryEntityParameters(arg.name);
  }
  developerChanged(arg) {
    this.filterMenu(arg.value);
  }
  onEntityParameter(section, parameter, value) {
    if (!this.mappedSections[section] || !this.mappedSections[section].mappedParameters[parameter]) return;
    this.mappedSections[section].mappedParameters[parameter].resetValue(value);
  }
}
exports.default = ParametersEditor;
// Dynamic menu parameters
class MenuParameter {
  constructor(section, name, type, visibility, defaultValue, dropdownValues, units) {
    _defineProperty(this, "section", void 0);
    _defineProperty(this, "key", void 0);
    _defineProperty(this, "developer", void 0);
    _defineProperty(this, "name", void 0);
    _defineProperty(this, "units", void 0);
    _defineProperty(this, "type", void 0);
    _defineProperty(this, "dropdown", void 0);
    _defineProperty(this, "value", void 0);
    _defineProperty(this, "oldValue", void 0);
    _defineProperty(this, "dirty", void 0);
    _defineProperty(this, "even", void 0);
    _defineProperty(this, "visible", void 0);
    this.section = section;
    this.key = name;
    this.developer = visibility == "developer";
    this.name = name;
    this.units = units;
    if (dropdownValues) {
      this.type = "dropdown";
      this.dropdown = new _Dropdown.default(value => {
        if (this.value === value.name) return;
        this.value = value.name;
        this.valueChanged({
          value: value.name
        });
      });
      var array = dropdownValues.split(",");
      for (var i = 0; i < array.length; i++) {
        var item = {
          name: array[i].trim()
        };
        this.dropdown.items.push(item);
      }
    } else if (type == "real") {
      this.type = "decimal";
    } else if (type == "integer") {
      this.type = "integer";
    } else if (type == "boolean") {
      this.type = "switch";
    } else {
      // list:real || matrix || list:integer || ...
      this.type = "text";
    }
    this.resetValue(defaultValue);
  }
  resetValue(value) {
    if (this.type == "switch") this.value = value == "1" || value && value.toLowerCase() == "true";else this.value = value;
    if (this.type == "dropdown") for (var i = 0; i < this.dropdown.items.length; i++) if (this.dropdown.items[i].name == this.value) this.dropdown.select(this.dropdown.items[i]);
    this.oldValue = this.value;
    //console.log("reset " + this.section.name + "/" + this.key + " = " + this.value);
  }

  valueChanged(arg) {
    // Defer applying text or number values to DUNE until focusLost(),
    // avoiding sending new values every time a new character is typed.
    if (this.type == "text" || this.type == "number") this.dirty = true;else this.applyValue(arg.value);
  }
  focusLost() {
    if (this.dirty) this.applyValue(this.value);
  }
  applyValue(value) {
    this.dirty = false;
    if (this.oldValue == value) return;
    this.oldValue = value;
    //console.log("apply " + this.section.name + "/" + this.key + " = " + value);
    _App.default.setEntityParameter(this.section.name, this.key, value);
  }
}
class MenuSection {
  constructor(editor, name) {
    _defineProperty(this, "editor", void 0);
    _defineProperty(this, "name", void 0);
    _defineProperty(this, "visible", true);
    _defineProperty(this, "selected", false);
    _defineProperty(this, "parameters", []);
    _defineProperty(this, "mappedParameters", {});
    this.editor = editor;
    this.name = name;
  }
  addParameter(name, type, visibility, defaultValue, dropdownValues, units) {
    var parameter = new MenuParameter(this, name, type, visibility, defaultValue, dropdownValues, units);
    this.parameters.push(parameter);
    this.mappedParameters[name] = parameter;
    parameter.even = this.parameters.length % 2 == 0;
    return parameter;
  }
  onSelect() {
    this.editor.onSelected(this);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQYXJhbWV0ZXJzRWRpdG9yIiwib3BlbiIsImZpbHRlck1lbnUiLCJ2aXNpYmxlIiwiY2xvc2UiLCJjbGVhciIsInNlY3Rpb25zIiwibGVuZ3RoIiwicGFyYW1ldGVycyIsIm1hcHBlZFNlY3Rpb25zIiwiYWRkU2VjdGlvbiIsIm5hbWUiLCJzZWN0aW9uIiwiTWVudVNlY3Rpb24iLCJwdXNoIiwiZGV2ZWxvcGVyIiwidW5kZWZpbmVkIiwiaSIsImoiLCJoYXZlU2VsZWN0ZWQiLCJvblNlbGVjdGVkIiwic2VsZWN0ZWQiLCJhcmciLCJOYXRpdmVBcHAiLCJxdWVyeUVudGl0eVBhcmFtZXRlcnMiLCJkZXZlbG9wZXJDaGFuZ2VkIiwidmFsdWUiLCJvbkVudGl0eVBhcmFtZXRlciIsInBhcmFtZXRlciIsIm1hcHBlZFBhcmFtZXRlcnMiLCJyZXNldFZhbHVlIiwiTWVudVBhcmFtZXRlciIsImNvbnN0cnVjdG9yIiwidHlwZSIsInZpc2liaWxpdHkiLCJkZWZhdWx0VmFsdWUiLCJkcm9wZG93blZhbHVlcyIsInVuaXRzIiwia2V5IiwiZHJvcGRvd24iLCJEcm9wZG93biIsInZhbHVlQ2hhbmdlZCIsImFycmF5Iiwic3BsaXQiLCJpdGVtIiwidHJpbSIsIml0ZW1zIiwidG9Mb3dlckNhc2UiLCJzZWxlY3QiLCJvbGRWYWx1ZSIsImRpcnR5IiwiYXBwbHlWYWx1ZSIsImZvY3VzTG9zdCIsInNldEVudGl0eVBhcmFtZXRlciIsImVkaXRvciIsImFkZFBhcmFtZXRlciIsImV2ZW4iLCJvblNlbGVjdCJdLCJzb3VyY2VzIjpbIlBhcmFtZXRlckVkaXRvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRHJvcGRvd24gZnJvbSBcIi4uL2NvbnRyb2xzL0Ryb3Bkb3duXCI7XG5pbXBvcnQgTmF0aXZlQXBwIGZyb20gXCJOYXRpdmUvQXBwXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBhcmFtZXRlcnNFZGl0b3Ige1xuICAgIGhhdmVTZWxlY3RlZDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGRldmVsb3BlcjogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHZpc2libGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBzZWN0aW9uczogTWVudVNlY3Rpb25bXSA9IFtdO1xuICAgIHBhcmFtZXRlcnM6IE1lbnVQYXJhbWV0ZXJbXSA9IFtdO1xuICAgIG1hcHBlZFNlY3Rpb25zOiB7fSA9IHt9O1xuXG4gICAgb3BlbigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5maWx0ZXJNZW51KCk7XG4gICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XG4gICAgfVxuXG4gICAgY2xvc2UoKTogdm9pZCB7XG4gICAgICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIGNsZWFyKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNlY3Rpb25zLmxlbmd0aCA9IDA7XG4gICAgICAgIHRoaXMucGFyYW1ldGVycy5sZW5ndGggPSAwO1xuICAgICAgICB0aGlzLm1hcHBlZFNlY3Rpb25zID0ge307XG4gICAgfVxuXG4gICAgYWRkU2VjdGlvbihuYW1lOiBzdHJpbmcpOiBNZW51U2VjdGlvbiB7XG4gICAgICAgIHZhciBzZWN0aW9uID0gbmV3IE1lbnVTZWN0aW9uKHRoaXMsIG5hbWUpO1xuICAgICAgICB0aGlzLnNlY3Rpb25zLnB1c2goc2VjdGlvbik7XG4gICAgICAgIHRoaXMubWFwcGVkU2VjdGlvbnNbbmFtZV0gPSBzZWN0aW9uO1xuICAgICAgICByZXR1cm4gc2VjdGlvbjtcbiAgICB9XG5cbiAgICBmaWx0ZXJNZW51KGRldmVsb3Blcj86IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgaWYgKGRldmVsb3BlciA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgZGV2ZWxvcGVyID0gdGhpcy5kZXZlbG9wZXI7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLnNlY3Rpb25zW2ldLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLnNlY3Rpb25zW2ldLnBhcmFtZXRlcnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlY3Rpb25zW2ldLnBhcmFtZXRlcnNbal0udmlzaWJsZSA9ICF0aGlzLnNlY3Rpb25zW2ldLnBhcmFtZXRlcnNbal0uZGV2ZWxvcGVyIHx8IGRldmVsb3BlcjtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWN0aW9uc1tpXS5wYXJhbWV0ZXJzW2pdLnZpc2libGUpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VjdGlvbnNbaV0udmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuaGF2ZVNlbGVjdGVkKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuc2VjdGlvbnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWN0aW9uc1tqXS52aXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25TZWxlY3RlZCh0aGlzLnNlY3Rpb25zW2pdKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICghZGV2ZWxvcGVyKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWN0aW9uc1tpXS5zZWxlY3RlZCAmJiAhdGhpcy5zZWN0aW9uc1tpXS52aXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5zZWN0aW9ucy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VjdGlvbnNbal0udmlzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25TZWxlY3RlZCh0aGlzLnNlY3Rpb25zW2pdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvblNlbGVjdGVkKGFyZzogTWVudVNlY3Rpb24pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzID0gYXJnLnBhcmFtZXRlcnM7XG4gICAgICAgIHRoaXMuaGF2ZVNlbGVjdGVkID0gdHJ1ZTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VjdGlvbnMubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICB0aGlzLnNlY3Rpb25zW2ldLnNlbGVjdGVkID0gdGhpcy5zZWN0aW9uc1tpXSA9PT0gYXJnO1xuXG4gICAgICAgIE5hdGl2ZUFwcC5xdWVyeUVudGl0eVBhcmFtZXRlcnMoYXJnLm5hbWUpO1xuICAgIH1cblxuICAgIGRldmVsb3BlckNoYW5nZWQoYXJnOiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5maWx0ZXJNZW51KGFyZy52YWx1ZSk7XG4gICAgfVxuXG4gICAgb25FbnRpdHlQYXJhbWV0ZXIoc2VjdGlvbjogc3RyaW5nLCBwYXJhbWV0ZXI6IHN0cmluZywgdmFsdWU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMubWFwcGVkU2VjdGlvbnNbc2VjdGlvbl0gfHxcbiAgICAgICAgICAgICF0aGlzLm1hcHBlZFNlY3Rpb25zW3NlY3Rpb25dLm1hcHBlZFBhcmFtZXRlcnNbcGFyYW1ldGVyXSlcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICB0aGlzLm1hcHBlZFNlY3Rpb25zW3NlY3Rpb25dLm1hcHBlZFBhcmFtZXRlcnNbcGFyYW1ldGVyXS5yZXNldFZhbHVlKHZhbHVlKTtcbiAgICB9XG59XG5cbnR5cGUgVmFsdWUgPSBzdHJpbmcgfCBib29sZWFuO1xuXG5pbnRlcmZhY2UgRGF0YSB7XG4gICAgdmFsdWU6IFZhbHVlO1xufVxuXG5pbnRlcmZhY2UgSXRlbSB7XG4gICAgbmFtZTogc3RyaW5nO1xufVxuXG4vLyBEeW5hbWljIG1lbnUgcGFyYW1ldGVyc1xuY2xhc3MgTWVudVBhcmFtZXRlciB7XG4gICAgc2VjdGlvbjogTWVudVNlY3Rpb247XG4gICAga2V5OiBzdHJpbmc7XG4gICAgZGV2ZWxvcGVyOiBib29sZWFuO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB1bml0czogc3RyaW5nO1xuICAgIHR5cGU6IHN0cmluZztcbiAgICBkcm9wZG93bjogRHJvcGRvd248SXRlbT47XG4gICAgdmFsdWU6IFZhbHVlO1xuICAgIG9sZFZhbHVlOiBWYWx1ZTtcbiAgICBkaXJ0eTogYm9vbGVhbjtcbiAgICBldmVuOiBib29sZWFuO1xuICAgIHZpc2libGU6IGJvb2xlYW47XG5cbiAgICBjb25zdHJ1Y3RvcihzZWN0aW9uOiBNZW51U2VjdGlvbiwgbmFtZTogc3RyaW5nLCB0eXBlOiBzdHJpbmcsIHZpc2liaWxpdHk6IHN0cmluZywgZGVmYXVsdFZhbHVlOiBzdHJpbmcsIGRyb3Bkb3duVmFsdWVzOiBzdHJpbmcsIHVuaXRzOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5zZWN0aW9uID0gc2VjdGlvbjtcbiAgICAgICAgdGhpcy5rZXkgPSBuYW1lO1xuICAgICAgICB0aGlzLmRldmVsb3BlciA9IHZpc2liaWxpdHkgPT0gXCJkZXZlbG9wZXJcIjtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy51bml0cyA9IHVuaXRzO1xuXG4gICAgICAgIGlmIChkcm9wZG93blZhbHVlcykge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gXCJkcm9wZG93blwiO1xuICAgICAgICAgICAgdGhpcy5kcm9wZG93biA9IG5ldyBEcm9wZG93bigodmFsdWU6IEl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZSA9PT0gdmFsdWUubmFtZSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlLm5hbWU7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZUNoYW5nZWQoe3ZhbHVlOiB2YWx1ZS5uYW1lfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciBhcnJheSA9IGRyb3Bkb3duVmFsdWVzLnNwbGl0KFwiLFwiKTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0ge25hbWU6IGFycmF5W2ldLnRyaW0oKX07XG4gICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5pdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJyZWFsXCIpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IFwiZGVjaW1hbFwiO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJpbnRlZ2VyXCIpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IFwiaW50ZWdlclwiO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJib29sZWFuXCIpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IFwic3dpdGNoXCI7XG4gICAgICAgIH0gZWxzZSB7IC8vIGxpc3Q6cmVhbCB8fCBtYXRyaXggfHwgbGlzdDppbnRlZ2VyIHx8IC4uLlxuICAgICAgICAgICAgdGhpcy50eXBlID0gXCJ0ZXh0XCI7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlc2V0VmFsdWUoZGVmYXVsdFZhbHVlKTtcbiAgICB9XG5cbiAgICByZXNldFZhbHVlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PSBcInN3aXRjaFwiKVxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlID09IFwiMVwiIHx8IHZhbHVlICYmIHZhbHVlLnRvTG93ZXJDYXNlKCkgPT0gXCJ0cnVlXCI7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcblxuICAgICAgICBpZiAodGhpcy50eXBlID09IFwiZHJvcGRvd25cIilcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5kcm9wZG93bi5pdGVtcy5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kcm9wZG93bi5pdGVtc1tpXS5uYW1lID09IHRoaXMudmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uc2VsZWN0KHRoaXMuZHJvcGRvd24uaXRlbXNbaV0pO1xuXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwicmVzZXQgXCIgKyB0aGlzLnNlY3Rpb24ubmFtZSArIFwiL1wiICsgdGhpcy5rZXkgKyBcIiA9IFwiICsgdGhpcy52YWx1ZSk7XG4gICAgfVxuXG4gICAgdmFsdWVDaGFuZ2VkKGFyZzogRGF0YSk6IHZvaWQge1xuICAgICAgICAvLyBEZWZlciBhcHBseWluZyB0ZXh0IG9yIG51bWJlciB2YWx1ZXMgdG8gRFVORSB1bnRpbCBmb2N1c0xvc3QoKSxcbiAgICAgICAgLy8gYXZvaWRpbmcgc2VuZGluZyBuZXcgdmFsdWVzIGV2ZXJ5IHRpbWUgYSBuZXcgY2hhcmFjdGVyIGlzIHR5cGVkLlxuICAgICAgICBpZiAodGhpcy50eXBlID09IFwidGV4dFwiIHx8IHRoaXMudHlwZSA9PSBcIm51bWJlclwiKVxuICAgICAgICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuYXBwbHlWYWx1ZShhcmcudmFsdWUpO1xuICAgIH1cblxuICAgIGZvY3VzTG9zdCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuZGlydHkpXG4gICAgICAgICAgICB0aGlzLmFwcGx5VmFsdWUodGhpcy52YWx1ZSk7XG4gICAgfVxuXG4gICAgYXBwbHlWYWx1ZSh2YWx1ZTogVmFsdWUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlO1xuXG4gICAgICAgIGlmICh0aGlzLm9sZFZhbHVlID09IHZhbHVlKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImFwcGx5IFwiICsgdGhpcy5zZWN0aW9uLm5hbWUgKyBcIi9cIiArIHRoaXMua2V5ICsgXCIgPSBcIiArIHZhbHVlKTtcbiAgICAgICAgTmF0aXZlQXBwLnNldEVudGl0eVBhcmFtZXRlcih0aGlzLnNlY3Rpb24ubmFtZSwgdGhpcy5rZXksIHZhbHVlKTtcbiAgICB9XG59XG5cbmNsYXNzIE1lbnVTZWN0aW9uIHtcbiAgICBlZGl0b3I6IFBhcmFtZXRlcnNFZGl0b3I7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHZpc2libGU6IGJvb2xlYW4gPSB0cnVlO1xuICAgIHNlbGVjdGVkOiBib29sZWFuID0gZmFsc2U7XG4gICAgcGFyYW1ldGVyczogTWVudVBhcmFtZXRlcltdID0gW107XG4gICAgbWFwcGVkUGFyYW1ldGVyczoge30gPSB7fTtcblxuICAgIGNvbnN0cnVjdG9yKGVkaXRvcjogUGFyYW1ldGVyc0VkaXRvciwgbmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIH1cblxuICAgIGFkZFBhcmFtZXRlcihuYW1lOiBzdHJpbmcsIHR5cGU6IHN0cmluZywgdmlzaWJpbGl0eTogc3RyaW5nLCBkZWZhdWx0VmFsdWU6IHN0cmluZywgZHJvcGRvd25WYWx1ZXM6IHN0cmluZywgdW5pdHM6IHN0cmluZyk6IE1lbnVQYXJhbWV0ZXIge1xuICAgICAgICB2YXIgcGFyYW1ldGVyID0gbmV3IE1lbnVQYXJhbWV0ZXIodGhpcywgbmFtZSwgdHlwZSwgdmlzaWJpbGl0eSwgZGVmYXVsdFZhbHVlLCBkcm9wZG93blZhbHVlcywgdW5pdHMpO1xuICAgICAgICB0aGlzLnBhcmFtZXRlcnMucHVzaChwYXJhbWV0ZXIpO1xuICAgICAgICB0aGlzLm1hcHBlZFBhcmFtZXRlcnNbbmFtZV0gPSBwYXJhbWV0ZXI7XG4gICAgICAgIHBhcmFtZXRlci5ldmVuID0gdGhpcy5wYXJhbWV0ZXJzLmxlbmd0aCAlIDIgPT0gMDtcbiAgICAgICAgcmV0dXJuIHBhcmFtZXRlcjtcbiAgICB9XG5cbiAgICBvblNlbGVjdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5lZGl0b3Iub25TZWxlY3RlZCh0aGlzKTtcbiAgICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFBbUM7QUFBQTtBQUFBO0FBQUE7QUFFcEIsTUFBTUEsZ0JBQWdCLENBQUM7RUFBQTtJQUFBLHNDQUNWLEtBQUs7SUFBQSxtQ0FDUixLQUFLO0lBQUEsaUNBQ1AsS0FBSztJQUFBLGtDQUNFLEVBQUU7SUFBQSxvQ0FDRSxFQUFFO0lBQUEsd0NBQ1gsQ0FBQyxDQUFDO0VBQUE7RUFFdkJDLElBQUksR0FBUztJQUNULElBQUksQ0FBQ0MsVUFBVSxFQUFFO0lBQ2pCLElBQUksQ0FBQ0MsT0FBTyxHQUFHLElBQUk7RUFDdkI7RUFFQUMsS0FBSyxHQUFTO0lBQ1YsSUFBSSxDQUFDRCxPQUFPLEdBQUcsS0FBSztFQUN4QjtFQUVBRSxLQUFLLEdBQVM7SUFDVixJQUFJLENBQUNDLFFBQVEsQ0FBQ0MsTUFBTSxHQUFHLENBQUM7SUFDeEIsSUFBSSxDQUFDQyxVQUFVLENBQUNELE1BQU0sR0FBRyxDQUFDO0lBQzFCLElBQUksQ0FBQ0UsY0FBYyxHQUFHLENBQUMsQ0FBQztFQUM1QjtFQUVBQyxVQUFVLENBQUNDLElBQVksRUFBZTtJQUNsQyxJQUFJQyxP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
